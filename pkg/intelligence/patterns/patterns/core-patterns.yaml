version: "1.0"
patterns:
  # Essential patterns that come with Tapio
  - id: crashloop-backoff
    name: CrashLoop BackOff Detection
    category: failure
    description: Pod stuck in crash loop
    enabled: true
    tags: ["core", "pod", "failure"]
    indicators:
      - type: event
        field: reason
        condition: equals
        value: CrashLoopBackOff
      - type: frequency
        field: container.restart
        threshold: 3
        time_window: 5m
    impact:
      severity: high
      scope: pod
      user_impact: true

  - id: oom-killed
    name: Out of Memory Kill
    category: resource
    description: Container killed due to memory limits
    enabled: true
    tags: ["core", "memory", "resource"]
    indicators:
      - type: event
        field: reason
        condition: equals
        value: OOMKilled
      - type: event
        field: message
        condition: contains
        value: "memory limit"
    impact:
      severity: high
      scope: pod
      user_impact: true
      performance_risk: true

  - id: image-pull-backoff
    name: Image Pull BackOff
    category: deployment
    description: Cannot pull container image
    enabled: true
    tags: ["core", "deployment", "image"]
    indicators:
      - type: event
        field: reason
        condition: in
        value: ["ErrImagePull", "ImagePullBackOff"]
    impact:
      severity: medium
      scope: pod
      user_impact: false

  - id: node-not-ready
    name: Node Not Ready
    category: resource
    description: Kubernetes node is not ready
    enabled: true
    tags: ["core", "node", "infrastructure"]
    indicators:
      - type: event
        field: reason
        condition: equals
        value: NodeNotReady
      - type: state
        field: node.status.conditions.Ready
        condition: equals
        value: "False"
    impact:
      severity: critical
      scope: node
      user_impact: true

  - id: pod-eviction
    name: Pod Eviction
    category: resource
    description: Pod evicted due to resource pressure
    enabled: true
    tags: ["core", "resource", "eviction"]
    indicators:
      - type: event
        field: reason
        condition: equals
        value: Evicted
      - type: event
        field: message
        condition: matches
        value: ".*(disk|memory|ephemeral-storage) pressure.*"
    impact:
      severity: high
      scope: pod
      user_impact: true

  - id: dns-failure
    name: DNS Resolution Failure
    category: network
    description: Service discovery DNS failures
    enabled: true
    tags: ["core", "network", "dns"]
    indicators:
      - type: event
        field: dns.error
        condition: in
        value: ["NXDOMAIN", "timeout", "refused"]
      - type: event
        field: message
        condition: contains
        value: "dial tcp: lookup"
    impact:
      severity: high
      scope: namespace
      user_impact: true